#!/usr/bin/env bash

items=`find ~/projects -maxdepth 2 -mindepth 2 -type d`
runner="ls"

if [[ -z "$1" ]]; then
    selected=`echo "$items" | fzf`
else
    selected=$1
fi

if ! [[ -z "$2" ]]; then
   runner="$2"
fi

if [ -z ${selected} ]; then
    echo "Please select an option"
else
    tmux_session_name=`basename $selected | tr . _`

    if ! tmux has-session -t $tmux_session_name; then
        tmux new-session -ds $tmux_session_name -c $selected
        tmux neww -c '#{pane_current_path}' -n 'server'
        tmux send-keys "$runner" C-m
        tmux previous-window
    fi

    if [[ -z $TMUX ]]; then
        tmux attach-session -t $tmux_session_name
    else
        tmux switch-client -t $tmux_session_name
    fi
fi

